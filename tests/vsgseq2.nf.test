nextflow_workflow {
    name "Test vsgseq2 integration"
    script "main.nf"
    workflow "vsgseq2"

    test("Should integrate modules") {

        when {
            params {
                samplesheet = "${outputDir}/test_samples.csv"
            }
            workflow {
                """
                new File("${outputDir}/test_samples.csv").text = '''sample,r1,r2
early_1,${projectDir}/tests/data/early_1_1.fastq.gz,${projectDir}/tests/data/early_1_2.fastq.gz
latesingle,${projectDir}/tests/data/latesingle.fq.gz,'''
                """
            }
        }

        then {
            assert workflow.success
            assert workflow.out.summary_champions
            with(workflow.out.summary_champions) {
                assert size() >= 1
                def lines = path(get(0)).readLines()
                assert lines.size() >= 2
                assert lines.any { it.startsWith('ATGAACAAAAAGGCCGTCGTTTCCGCACTGGTAATAGCGACGCTATTAACCGACAAAGGC') }
                assert lines.any { it.startsWith('ATGCCCTCAAGCAACTCGAAAACTGCACACTTACAAGCAGCAGTCCTCATACAATTGATT') }
                assert lines.any { it.startsWith('ATGATAAAAACAATCACCACCGTAGCATTGCTGGTGATAGGGTCAGCAAGTGCGATAGCA') }
                assert lines.any { it.startsWith('ATGCTTCAAGCGCTAGCAATAGCCGTTATGTTATCGCTGCAAAGGTCGACAGCAAAGAAC') }
            }
        }

    }

}